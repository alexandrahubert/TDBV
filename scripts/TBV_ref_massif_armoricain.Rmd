---
title: "Hydromorphologie des cours d'eau en têtes de bassin versant"
author: "Pascal IRZ, Julien BOËTON, Alexandra HUBERT, Mikaël LE BIHAN - OFB, Direction
  Régionale Bretagne
  
  Gabriel MELUN - OFB, Direction de la recherche et de l'appui scientifique"
date: "`r format(Sys.time(), 'Le %d/%m/%Y')`"
output:
  bookdown::html_document2:
    fig_caption: yes
    tab_caption: yes
    number_sections: yes
    global_numbering: yes
    toc: yes
    toc_float:
      toc_collapsed: yes
      toc_depth: 2
    code_folding: hide
    css: "style.css"
    
  word_document: default
  pdf_document: default
subtitle: Analyses préliminaires sur les stations de cours d'eau de référence hydromorphologique de l'hydroécorégion de niveau 1 "Massif Armoricain"
runtime: shiny
resource_files:
- www/favicon.ico
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
# chargement des packages
library(dplyr)
library(tidyr)
library(tibble)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(plotly)
library(flextable)
library(shiny)
library(bookdown)
```

```{r, echo = FALSE}
htmltools::img(src = knitr::image_uri('logo_OFB.jpg'),
               alt = 'logo',
               style = 'position:absolute; top:0; right:0; padding:0px; width:100px;')

# use_favicon()
# golem::use_favicon("www/favicon.ico")
```

>Mots-clés : cours d’eau ; hydromorphologie ; lit mineur ; condition naturelle ; restauration ; tête de bassin versant

# Introduction

Cette page thématique présente une analyse préliminaire des caractéristiques hydromorphologique des cours d'eau en têtes de bassin versant, réalisée par la Direction régionale Bretagne de l'Office Français de la Biodiversité. Elle vise à fournir des éléments de connaissance sur les caractéristiques hydromorphologiques des cours d’eau sur des stations proches des conditions naturelles (peu ou pas impactées) dans l’HydroEcoRégion (HER) de niveau 1 « Massif Armoricain ». L'établissement et la connaissance de ces données de référence est de nature à améliorer l’efficacité des opérations de restauration écologique de cours d’eau sur ce territoire.

:::: {.defbox data-latex=""}

Les cours d’eau en têtes de bassin versant se localisent à l’extrémité amont du réseau hydrographique. La classification de Strahler (Strahler, 1957) a été majoritairement utilisée dans le cadre des études tendant à définir spatialement ces cours d’eau en têtes de bassin (Tixier et al., 2012). Cette classification est fondée sur l’importance croissante des branches qui constituent le réseau hydrographique. En France métropolitaine, et dans la plupart des Schémas Directeurs d'Aménagement et de Gestion des Eaux (SDAGE), sont considérés en têtes de bassin, les cours d’eau de rang de Strahler 1 et 2 à l’échelle 1 : 25 000$^{ème}$.

::::



Des données ont été collectées par l'OFB dans le cadre de stages de Master 2 entre 2013 et 2019 sur des cours d’eau qualifiés de "non impactés" vis à vis de leurs caractéristiques hydromorphologiques (Jan, 2013 ; Bossis, 2014 ; Gallineau, 2020). Le protocole de terrain mis en œuvre à l’échelle stationnelle visait à recueillir les principales caractéristiques hydromorphologiques du lit mineur et de la ripisylve sur des stations localisées sur des cours d'eau de rang de Strahler de 1 à 4, avec une majorité de cours d'eau de rang de Strahler 1. Les caractéristiques principales des bassins versants en amont des tronçons ont été obtenues par géotraitement sous le logiciel QGis.

Afin de mettre en perspective les résultats obtenus sur ce jeu de données de la direction Bretagne de l’OFB, les mêmes analyses ont été menées sur les stations qualifiées "de référence" de [l'IED Carhyce](https://analytics.huma-num.fr/ied_carhyce/) sur la même HydroEcoRégion. Les protocoles de terrain de ces différents jeux de données ne sont pas identiques, cependant certains paramètres sont similaires et se recoupent.

```{r}
# chargement du tableau de données au format RData
load(file = "ref.RData")

# chargement des graphiques au format RData
load(file = "graphiques.RData")

# chargement des fonctions
source(file = "00_fonctions.R")
```

Le tableau assemblé comprend au total `r nrow(ref)` lignes correspondant à 1) `r ref %>% filter(jeu_donnees != 'carhyce_ref_armo') %>% nrow()` stations localisées sur les cours d'eau étudiés par la DR Bretagne et 2) `r ref %>% filter(jeu_donnees == 'carhyce_ref_armo') %>% nrow()` stations dont les données proviennent de [l'IED Carhyce](https://analytics.huma-num.fr/ied_carhyce/) (Table 1).

Dans le détail, 3 jeux de données peuvent être distingués dans les analyses suivantes, en lien notamment avec un critère de nombre de stations :

- le jeu de données « têtes de bassins de référence » issu des travaux de Jan (2013) et Bossis (2014) sur des cours d’eau de rang 1 en Bretagne et Pays de la Loire (n=`r n_sites_par_source[3,2]`  stations) ;
- le jeu de données issu des travaux de Galineau (2020) sur des cours d’eau de rang 1 à 4 en Bretagne et Pays de la Loire (n=`r n_sites_par_source[2,2]` stations)  ;
- le jeu de données issu de Carhyce, intégrant des cours d’eau plus importants, de rang 1 à X sur l'HydroEcoRégion "Massif Armoricain" (n=`r n_sites_par_source[1,2]` stations). 


```{r tab:table1}
ref %>%
  downloadthis::download_this(
    output_name = "hydromorpho_ref_armo",
    output_extension = ".xlsx",
    button_label = "Télécharger en Excel",
    button_type = "success",
    has_icon = TRUE,
    icon = "fa fa-save",
    csv2 = TRUE,
  )

ref %>% 
  select(-Code_tron,
         -dist_inter_rad,
         -Coef_sinuo) %>%
  mutate_at(vars(pente_eau_m_m, l_h),
            function(x) round(x, 5)) %>% 
  DT::datatable(caption = "Table 1 : Assemblage des données de l'IED Carhyce et des mesures de terrain réalisées par la DR OFB Bretagne. La variable `etiquette` est obtenue par concaténation de la référence de la station et du nom du cours d'eau car aucune de ces variables n'est renseignée dans 100% des cas. Elle sert à identifier les points sur les graphiques interactifs.")
```
L'interface cartographique ci-dessous présente la localisation des différentes stations étudiées, en distinguant les trois jeux de données (figure 1).  
```{r, fig.width = 8, fig.height = 8, fig.cap = "Carte des sites prospectés."}
# mapview::mapview(donnees_carte,
#                  zcol = "Source",
#                  layer.name = "Source",
#                  popup = leafpop::popupTable(
#       donnees_carte,
#       zcol = c("Station",
#                "Source")))
test <-  mapview::mapview(donnees_carte,
    zcol = "Source",
    layer.name = "Source",
    popup = leafpop::popupTable(
      donnees_carte,
      zcol = c("Station",
               "Source"),
      feature.id = FALSE,
      row.numbers = FALSE
    )
  )

test@map
```


L'hypothèse sous-jacente aux analyses présentées ci-dessous est que les variables de contrôle du bassin versant (exemple : superficie du bassin versant amont) contraignent les variables de réponse (ex : largeur à plein bord, hauteur à plein bord, etc.) à l’échelle du cours d’eau (Malavoi & Bravard, 2010). Cette corrélation est bien documentée sur les grands cours d'eau, mais les cours d'eau en têtes de bassin versant ont été moins étudiés. 

Les caractéristiques des bassins versants à l’amont de chaque station étudiée et qui sont utilisées dans l'analyse ci-dessous sont :

- La *superficie* du bassin versant, en km².
- La *pente*, en m/m. Ici c'est la pente longitudinale de la ligne d'eau du cours d'eau au niveau de la station qui est prise comme *proxy* de la pente du bassin versant.

Les variables de réponses retenues sont *la largeur et la hauteur à plein bord* (moyennes sur l'ensemble des transects par station, exprimées en m) ainsi que le ratio entre la largeur à plein bord sur la hauteur à plein bord (rapport de forme).

# Distribution des variables

Les distributions des variables sont données ci-dessous en comparant les jeux de données afin de bien présenter les ordres de grandeur (figure 2). Celles qui prennent des valeurs très dispersées sont représentées en échelle logarithmique $log$ (base 10).


```{r, fig.height = 10, fig.width = 10, fig.cap = "Distribution des variables. Les lignes verticales indiquent la valeur moyenne pour chaque jeu de données."}
g_densite
```

Les largeurs à plein bord du jeu de données "Jan & Bossis" sont toutes inférieures à 5 m, avec une moyenne de l'ordre d'un mètre. Les largeurs à plein bord moyennes des données issues de "Galineau" et de "Carhyce" sont logiquement plus importantes ; respectivement de 6 m et 9 m.

Les écarts sont moins nets sur les hauteurs à plein bord mais le même "ordre" est observé. En moyenne les hauteurs à plein bord sont de 0,3 (Jan & Bossis), 0,6 (Galineau) et 0,9 m (CARHYCE).

Les écarts sont nettement plus importants en termes de surface du bassin versant amont, ce qui conduit à représenter les distributions en échelle log. Les ordres de grandeur pour les trois jeux de données précédents sont respectivement de 1, 10 et 100 km².

Les petits bassins versants (< 10 km²) sont marqués par de fortes pentes de la ligne d'eau.

Le rapport de forme (largeur plein bord/hauteur plein bord) est, en moyenne, inférieur dans le jeu de données "Jan & Bossis" en comparaison des deux autres jeux de données ("Galineau" et "Carhyce").


# Analyse bivariée

Dans un premier temps, on observe les relations des variables deux à deux.

## Les variables explicatives (de contrôle)

Sur le graphique ci-dessous (figure 3), une droite de régression a été calée pour chacun des 3 jeux de données. La courbe grise en pointillés indique une tendance non linéaire sur l'ensemble des données.


```{r, fig.cap="Relation entre la pente de la ligne d'eau et la surface du bassin versant, distinguant les trois jeux de données."}
g_pente_sbv
```

En échelle log-log, le lien entre les deux variables explicatives est fort (sur l'ensemble des trois jeux de données, *r²*=$`r pente_sbv_r2`$, *p-value*=$`r pente_sbv_pvalue`$). Il est possible que la relation soit plutôt curvi-linéaire que linéaire. La relation est décroissante, et logiquement la pente est d'autant plus faible que la station étudiée est située en aval (bassin versant plus grand).

Les plus petits bassins sont bien ceux du jeu de données "Jan & Bossis" (0,1 à 2,2 km²), les plus grands ceux du jeu de données "Carhyce" (2,2 à 626,5 km²), et ceux de "Galineau" en position intermédiaire (3,9 à 72,8 km²). Sur la figure 3, une discontinuité de la pente en fonction de la surface du bassin-versant apparaît, certaines pentes de stations issues du jeu de données de référence sont assez faibles.

Quelques stations sont très éloignées du schéma général et méritent des vérifications (ex : Ref_0065, ou bien le Dolo dans Carhyce).

## Relation entre surface du bassin versant et morphologie du lit mineur

A commenter ou retirer graph ? Gabriel ?

```{r, fig.cap="Relation entre la largeur à plein bords et la surface du bassin versant, distinguant les trois jeux de données."}
g_lpb_sbv
```


```{r, fig.cap="Relation entre la hauteur à plein bords et la surface du bassin versant, distinguant les trois jeux de données."}
g_hpb_sbv
```


```{r, fig.cap="Relation entre la largeur à plein bords et la pente de la ligne d'eau, distinguant les trois jeux de données."}
g_lpb_pente
```


```{r, fig.cap="Relation entre la hauteur à plein bords et la pente de la ligne d'eau, distinguant les trois jeux de données."}
g_hpb_pente
```





# Modélisation

## Modèles complets

Pour évaluer les effets combinés des deux variables explicatives (surface de bassin versant et pente), sur la largeur et la hauteur à plein bord des lits mineurs, des régressions multiples ont été réalisées. D'après les graphiques, les relations *log-log* semblent linéaires. Cependant, quelques essais montrent que les modèles sont mieux ajustés en ne transformant que les variables explicatives :

$x \rightarrow \log_{10}(1+x)$

L'ajout de 1 dans l'équation permet de conserver des valeurs positives ou nulles.

Ainsi, les modèles sont de la forme suivante :

$hauteur\ à\ plein\ bord = a\cdot log_{10}(1+surface\_bv) + b\cdot log_{10}(1+pente)+c$

```{r}
# chargement du tableau de données au format RData
load(file = "modeles.RData")

modeles %>% 
  rename(`Surface BV` = `log10(1 + Surface_BV_km2)`,
         `Pente` = `log10(1 + pente_eau_m_m)`,
          Constante = `(Intercept)`) %>% 
  mutate(r2 = round(r2, 2)) %>% 
  flextable() %>%
  set_table_properties(layout = "autofit", width = 1) %>% 
  align(j = c(1, 3:6), align = "center", part = "all") %>% 
  hline(i = 3)
```

La superficie du bassin versant amont présente des coefficients de corrélation toujours significatifs. Cette superficie constitue la principale variable qui contribue à expliquer la largeur et la hauteur à plein bord du lit mineur d'un cours d'eau. Ces coefficients sont positifs, indiquant un effet "taille" : plus un bassin versant est grand, plus le lit mineur du cours d'eau est large et profond (Malavoi & Bravard, 2010).

L'effet de la pente n'est significatif que sur un modèle, avec une `p-value` entre `0.05` et `0.01`, ce qui n'est pas très convaincant. Il s'agit vraisemblablement d'une mauvaise estimation de ce coefficient, ce qui arrive quand les variables explicatives sont corrélées entre elles. Cela vient peut etre aussi du fait que la pente des stations ne suit pas le modèle conceptuel de décroissance vers l’aval (exemple des têtes de bassin versant à faible pente).

Les coefficients de détermination ajustés `r²` sont plus faibles pour les têtes de bassin versant que pour les deux autres jeux de données, malgré l'effet très significatif de la surface du bassin versant. Sur ces deux autres jeux de données, ils sont particulièrement élevés (`>0.90`) pour la largeur plein bord `Lpb`. Ils sont de l'ordre de `0.80` pour la hauteur plein bord `Hpb`.

## Modèles simplifiés

Dans un but de parcimonie, et pour s'affranchir des problèmes liés à la colinéarité entre variables explicatives, on peut simplifier les modèles en ne conservant que la surface du bassin versant comme variable explicative. On peut aussi essayer de combiner notre jeu de données avec les autres. Les résultats obtenus sont les suivants :

```{r}
modeles_simp %>% 
  rename(`Surface BV` = `log10(1 + Surface_BV_km2)`,
          Constante = `(Intercept)`) %>% 
  mutate(r2 = round(r2, 2)) %>% 
  flextable() %>%
  set_table_properties(layout = "autofit", width = 1) %>% 
  align(j = c(1, 3:5), align = "center", part = "all") %>% 
  hline(i = 5)
```

Ces modèles sont très cohérents. La perte sur le coefficient de détermination ajusté est négligeable en omettant la pente. Ces modèles semblent donc être les plus intéressants.

## Modèles finaux

La seule variable explicative retenue est donc la surface du bassin versant. Les figures 4 et 6 suggèrent toutefois que la relation entre cette variable et les dimensions à plein bord du lit pourraient être curvilinéaires. Afin d'en tenir compte, on peut essayer d'ajouter au modèle un terme quadratique, c'est-à-dire de caler pour la hauteur plein bord :

$hauteur\ à\ plein\ bord = a_1\cdot log_{10}(1+surface\_bv) + a_2\cdot (log_{10}(1+surface\_bv))^2+b$

Les résultats n'apportent pas d'amélioration, donc le modèle final retenu est tel que :

>$hauteur\ à\ plein\ bord = a\cdot log_{10}(1+surface\_bv)+b$

Afin de le caler au mieux sur les têtes de bassin versant, on l'ajuste sur le jeu de données combiné restreint aux bassins inférieurs à 10 km² (Brummer & Montgomery, 2003 ; MacDonald & Coe, 2007). Au-delà de cette valeur il est préférable de se reporter à Carhyce.

```{r}
mf_lpb <- lm_unitaire(
  data = ref %>% filter(Surface_BV_km2 < 20),
  var_dep = "Lpb",
  jeu_donnees_selectionne = c("tbv_ref", "galineau_2020", "carhyce_ref_armo"),
  pente_incluse = FALSE
)

mf_hpb <- lm_unitaire(
  data = ref %>% filter(Surface_BV_km2 < 20),
  var_dep = "Hpb",
  jeu_donnees_selectionne = c("tbv_ref", "galineau_2020", "carhyce_ref_armo"),
  pente_incluse = FALSE
)

rbind(mf_lpb[[2]], mf_hpb[[2]]) %>% 
    as.data.frame() %>%
  rownames_to_column() %>%
  separate(
    col = rowname,
    into = c("Variable dépendante", "jeu_donnees"),
    sep = " / "
  ) %>% 
  select(-jeu_donnees) %>% 
    rename(`a (Surface BV)` = `log10(1 + Surface_BV_km2)`,
          `b (Constante)` = `(Intercept)`) %>% 
  mutate(r2 = round(r2, 2)) %>% 
  flextable() %>%
  set_table_properties(layout = "autofit", width = 1) %>% 
  align(align = "center", part = "all")
```


# Recommandations pour le dimensionnement des lits mineurs dans le cadre de projets de restauration


De nombreux projets de restauration de l'hydromorphologie des cours d'eau ont pour principal objectif de retrouver une géométrie du lit mineur proche des conditions naturelles. Pour ce faire, deux choix techniques sont possibles : reconstituer un nouveau lit mineur ou réduire la section d'écoulement d'un lit mineur existant.


Afin de dimensionner un nouveau lit mineur, il convient de privilégier le recours à des segments hydromorphologiques de référence (proches des conditions naturelles) sur le même cours d'eau, à proximité immédiate du site à restaurer.
Généralement, en l'absence de stations de référence à proximité directe, le dimensionnement repose sur le calcul de la crue journalière de fréquence annuelle à biennale (QJ1 à QJ2) (Malavoi & Bravard, 2010). Ce calcul s'effectue à l'aide du ratio de BV simple, établi par rapport à une station hydrolométrique présentant des caractéristiques relativement similaires au site étudié (surface de bassin versant, géologie, relief, etc.). 


Le calculateur proposé ci-dessous et issu de données de référence sur les caractéristiques hydromorphologiques de 139 stations réparties sur l'HydroEcoRégion "Massif Armoricain", peut permettre de vérifier le dimensionnement de la largeur et de la profondeur à plein bord du lit mineur obtenu par les calculs hydrauliques précédents (ratio de BV simple).


Attention, les valeurs calculées ne doivent pas conduire à effectuer des reconstitutions de lits mineurs homogènes, il est en effet nécessaire de diversifier les largeurs et les profondeurs afin de concourir à la réussite du projet de restauration. De plus, comme ces valeurs sont issues de caractéristiques relevées sur des cours d'eau qui ont évolué dans le temps, il est conseillé de légèrement sous-dimensionner les largeurs et hauteurs à plein bord du lit mineur par rapport aux valeurs données par l'outil, afin de favoriser les ajustements hydromorphologiques.


Une vigilance particulière devra être apportée sur l'utilisation de cet outil pour des cours d'eau présentant des pentes très faibles (quelques pour mille) ou très fortes (> à 5 ou 6 %). En effet, ces valeurs de pente sont pour le moment peu représentées dans le jeu de données actuel. 


Pour rappel, la quasi-totalité des stations de référence étudiées sont bordées par une ripisylve dense, multi-strates, composée d'essences locales et diversifiées, naturellement présentes en bordure des cours d'eau. La reconstitution d'une ripisylve fonctionnelle est déterminante pour garantir l'éfficacité et la réussite des projets de restauration.


De plus, en "contexte argileux", les cours d'eau proches des conditions naturelles présentent des berges verticales basses. Cette forme de berges constitue la forme d'équilibre sur ce type de sol et permet la reconstitution naturelle de sous-berges.

```{r}
inputPanel(
  shiny::numericInput(
    "sbv",
    label = "Saisissez la surface de votre bassin versant, en km²",
    value = 1.5,
    step = 0.1
  )
)
```



```{r}
new_data <- reactive({
  data.frame(Surface_BV_km2 = input$sbv)
})
```


```{r}
output$pred_lpb <- renderText({ 
 raw_pred_lpb <-
    predict.lm(mf_lpb[[1]], newdata = new_data(), interval = "confidence")
  
 paste0("Largeur plein bord : ",
        round(raw_pred_lpb[1], 2),
        "m, IC = [",
        round(raw_pred_lpb[2], 2),
        "-",
        round(raw_pred_lpb[3], 2),
        "]")
})

output$pred_hpb <- renderText({ 
 raw_pred_hpb <-
    predict.lm(mf_hpb[[1]], newdata = new_data(), interval = "confidence")
  
 paste0("Hauteur plein bord : ",
        round(raw_pred_hpb[1], 2),
        "m, IC = [",
        round(raw_pred_hpb[2], 2),
        "-",
        round(raw_pred_hpb[3], 2),
        "]")
})
```

:::: {.colorbox data-latex=""}

Valeurs prédites par le modèle, avec entre crochets l'intervalle de confiance associé.

```{r}
verbatimTextOutput("pred_lpb")
verbatimTextOutput("pred_hpb")
```

::: {.center data-latex=""}

**ATTENTION**
:::
Ces valeurs ne doivent être utilisées qu’en l’absence de station de référence à l’amont immédiat du linéaire de cours d’eau étudié. De plus, les valeurs de géométrie du lit proposées par cet outil ne sont applicables que sur des bassins versants de moins de 10 km² et situés dans l'hydroEcoRégion de niveau 1 "Massif Armoricain".
::::





